# FINAL MASTER PROMPT: Attorney Accountability Hub Plugin

## Project Overview

Build a simple, functional WordPress plugin that unifies Directorist and MemberPress dashboards, adds a complaints system, and integrates with existing attorney custom fields.

---

## What's Already Done ✅

### 1. Custom Fields (Already Configured in Directorist)
You've already added these custom fields to attorney listings in Directorist:

**Legal Credentials Section:**
- ✅ Bar Number (text field)
- ✅ State of Admission (multi-select/dropdown)
- ✅ Practice Areas (multi-select checkboxes)
- ✅ Years of Experience (number field)
- ✅ Law Firm Name (text field)
- ✅ License Status (dropdown: Active/Inactive/Suspended)
- ✅ Disciplinary History (textarea)

**Evidence/Documentation:**
- ✅ Evidence Upload (file upload field)

**Search Filters:**
- ✅ Practice Areas (searchable)
- ✅ State of Admission (searchable)
- ✅ License Status (searchable)

### 2. Pages Created
- ✅ User Dashboard page (ID: 1269, slug: `/user-dashboard/`)
- ✅ Pricing page (slug: `/plans/pricing/`)
- ✅ File Complaint page (slug: `/file-a-complaint/`)

### 3. MemberPress Memberships
- ✅ Free Member (slug: `free-member`)
- ✅ Verified Reviewer (slug: `verified-reviewer`)
- ✅ Attorney Pro Account (slug: `attorney-pro`)

### 4. Theme & Plugins
- ✅ OneListing theme installed
- ✅ Directorist plugin active
- ✅ MemberPress plugin active

---

## What You Need to Build

### Plugin Requirements

**Primary Goal:** Create ONE unified dashboard (not two separate ones)

**Features to Implement:**

1. **Dashboard Unification**
   - Redirect MemberPress account page → Directorist dashboard
   - Add custom tabs to Directorist dashboard
   - Show MemberPress membership info in dashboard
   - Show billing history in dashboard
   - Conditional tabs based on membership level

2. **Complaints System**
   - Custom post type for complaints
   - File complaint form with attorney selection
   - Evidence file upload
   - Admin approval workflow
   - Email notifications
   - Dashboard integration (My Complaints tab)
   - Attorney dashboard (Complaints Against Me tab)

3. **Review System Integration**
   - Use Directorist built-in reviews (already exists)
   - Restrict to Verified Reviewer+ only
   - No new review system needed - just add access control

4. **Claim Listing Integration**
   - Use Directorist claim feature (already exists)
   - Restrict to Attorney Pro only
   - No custom claim system needed - just add access control

---

## Technical Specifications

### Environment
- **WordPress:** 5.8+
- **PHP:** 7.4+
- **Database:** MySQL 5.7+
- **Required Plugins:** MemberPress (latest), Directorist (latest)
- **Theme:** OneListing

### Site Configuration

**Page IDs & Slugs:**
```php
// Dashboard page
ID: 1269
Slug: /user-dashboard/
URL: get_permalink(1269) or home_url('/user-dashboard/')

// Pricing page
Slug: /plans/pricing/
URL: home_url('/plans/pricing/')

// File Complaint page
Slug: /file-a-complaint/
URL: home_url('/file-a-complaint/')
```

**Membership Tiers:**
```php
// Free Member
Slug: 'free-member'
Can: Browse directory, view profiles

// Verified Reviewer
Slug: 'verified-reviewer'
Can: Submit reviews, file complaints, all Free Member features

// Attorney Pro
Slug: 'attorney-pro'
Can: Claim listings, edit profile, all Verified Reviewer features
```

**Directory Post Type:**
```php
Post Type: 'at_biz_dir'
```

**Custom Fields (Already in Directorist):**
- Bar Number: `bar_number`
- State of Admission: `state_of_admission`
- Practice Areas: `practice_areas`
- Years of Experience: `years_experience`
- Law Firm Name: `law_firm_name`
- License Status: `license_status`
- Disciplinary History: `disciplinary_history`

---

## Plugin Structure (Keep It Simple)

```
attorney-hub/
├── attorney-hub.php              # Main plugin file
├── includes/
│   ├── helpers.php               # Helper functions
│   ├── capabilities.php          # Permission checks
│   ├── dashboard-tabs.php        # Dashboard tab system
│   └── complaints.php            # Complaints system
├── templates/
│   ├── tab-membership.php        # MemberPress membership display
│   ├── tab-billing.php           # Billing history display
│   ├── tab-complaints.php        # User's complaints list
│   ├── tab-complaints-received.php  # Attorney's received complaints
│   └── complaint-form.php        # Complaint submission form
└── assets/
    ├── css/
    │   └── dashboard.css         # Dashboard styles
    └── js/
        └── dashboard.js          # Dashboard scripts
```

**Total: 10 files**

---

## Code Implementation

### 1. Main Plugin File (attorney-hub.php)

```php
<?php
/**
 * Plugin Name: Attorney Hub - Dashboard Unification
 * Description: Unifies Directorist and MemberPress dashboards with complaints system
 * Version: 1.0.0
 * Author: Attorney Accountability Hub
 * Text Domain: attorney-hub
 */

if (!defined('ABSPATH')) exit;

// Define constants
define('ATTORNEY_HUB_VERSION', '1.0.0');
define('ATTORNEY_HUB_PATH', plugin_dir_path(__FILE__));
define('ATTORNEY_HUB_URL', plugin_dir_url(__FILE__));
define('ATTORNEY_HUB_DASHBOARD_ID', 1269); // Dashboard page ID

// Load files
require_once ATTORNEY_HUB_PATH . 'includes/helpers.php';
require_once ATTORNEY_HUB_PATH . 'includes/capabilities.php';
require_once ATTORNEY_HUB_PATH . 'includes/dashboard-tabs.php';
require_once ATTORNEY_HUB_PATH . 'includes/complaints.php';

// Enqueue assets on dashboard page only
add_action('wp_enqueue_scripts', 'aah_enqueue_assets');
function aah_enqueue_assets() {
    if (is_page(ATTORNEY_HUB_DASHBOARD_ID)) {
        wp_enqueue_style(
            'aah-dashboard', 
            ATTORNEY_HUB_URL . 'assets/css/dashboard.css', 
            [], 
            ATTORNEY_HUB_VERSION
        );
        
        wp_enqueue_script(
            'aah-dashboard', 
            ATTORNEY_HUB_URL . 'assets/js/dashboard.js', 
            ['jquery'], 
            ATTORNEY_HUB_VERSION, 
            true
        );
        
        // Localize script for AJAX
        wp_localize_script('aah-dashboard', 'aahData', [
            'ajax_url' => admin_url('admin-ajax.php'),
            'nonce' => wp_create_nonce('aah_nonce')
        ]);
    }
}
```

### 2. Helper Functions (includes/helpers.php)

```php
<?php
/**
 * Helper Functions
 */

if (!defined('ABSPATH')) exit;

/**
 * Check if user has specific membership
 */
function aah_user_has_membership($user_id, $slug) {
    if (!function_exists('mepr_get_user')) {
        return false;
    }
    
    $user = new MeprUser($user_id);
    $memberships = $user->active_product_subscriptions('ids');
    
    foreach ($memberships as $membership_id) {
        $product = new MeprProduct($membership_id);
        if ($product->post_name === $slug) {
            return true;
        }
    }
    
    return false;
}

/**
 * Check if user can file complaints
 */
function aah_can_file_complaints($user_id) {
    return aah_user_has_membership($user_id, 'verified-reviewer') || 
           aah_user_has_membership($user_id, 'attorney-pro');
}

/**
 * Check if user is attorney pro
 */
function aah_is_attorney_pro($user_id) {
    return aah_user_has_membership($user_id, 'attorney-pro');
}

/**
 * Get user's membership level
 */
function aah_get_membership_level($user_id) {
    if (aah_is_attorney_pro($user_id)) {
        return 'attorney-pro';
    }
    if (aah_can_file_complaints($user_id)) {
        return 'verified-reviewer';
    }
    return 'free-member';
}

/**
 * Get template file
 */
function aah_get_template($template_name, $args = []) {
    if (!empty($args) && is_array($args)) {
        extract($args);
    }
    
    $template_path = ATTORNEY_HUB_PATH . 'templates/' . $template_name;
    
    if (file_exists($template_path)) {
        include $template_path;
        return true;
    }
    
    return false;
}

/**
 * Get all attorneys for dropdown
 */
function aah_get_attorneys_list() {
    return get_posts([
        'post_type' => 'at_biz_dir',
        'posts_per_page' => -1,
        'post_status' => 'publish',
        'orderby' => 'title',
        'order' => 'ASC'
    ]);
}
```

### 3. Capabilities (includes/capabilities.php)

```php
<?php
/**
 * User Capability Checks
 */

if (!defined('ABSPATH')) exit;

/**
 * Check if user can submit reviews
 * Integrates with Directorist review system
 */
add_filter('atbdp_can_user_review', 'aah_can_user_review', 10, 3);
function aah_can_user_review($can_review, $listing_id, $user_id) {
    // Must be Verified Reviewer or Attorney Pro
    return aah_can_file_complaints($user_id);
}

/**
 * Check if user can claim listings
 * Integrates with Directorist claim system
 */
add_filter('atbdp_can_user_claim_listing', 'aah_can_user_claim', 10, 2);
function aah_can_user_claim($can_claim, $listing_id) {
    // Only Attorney Pro can claim
    return aah_is_attorney_pro(get_current_user_id());
}

/**
 * Restrict editing of specific fields after claim
 */
add_filter('atbdp_user_can_edit_field', 'aah_restrict_field_editing', 10, 3);
function aah_restrict_field_editing($can_edit, $field_name, $listing_id) {
    // Admin-only fields
    $admin_only_fields = [
        'bar_number',
        'disciplinary_history'
    ];
    
    if (in_array($field_name, $admin_only_fields)) {
        // Only admin can edit these fields
        return current_user_can('manage_options');
    }
    
    return $can_edit;
}
```

### 4. Dashboard Tabs (includes/dashboard-tabs.php)

```php
<?php
/**
 * Dashboard Tab System
 */

if (!defined('ABSPATH')) exit;

/**
 * Redirect MemberPress account page to Directorist dashboard
 */
add_action('template_redirect', 'aah_redirect_memberpress_to_directorist', 1);
function aah_redirect_memberpress_to_directorist() {
    if (is_page(get_option('mepr_account_page_id'))) {
        wp_redirect(get_permalink(ATTORNEY_HUB_DASHBOARD_ID));
        exit;
    }
}

/**
 * Add custom tabs to Directorist dashboard
 */
add_filter('atbdp_user_nav_items', 'aah_add_dashboard_tabs', 20);
function aah_add_dashboard_tabs($items) {
    $user_id = get_current_user_id();
    $dashboard_url = get_permalink(ATTORNEY_HUB_DASHBOARD_ID);
    
    // Membership tab (all users)
    $items['membership'] = [
        'label' => __('Membership', 'attorney-hub'),
        'icon' => 'la la-crown',
        'url' => add_query_arg('tab', 'membership', $dashboard_url)
    ];
    
    // Billing History tab (all users)
    $items['billing'] = [
        'label' => __('Billing History', 'attorney-hub'),
        'icon' => 'la la-file-invoice-dollar',
        'url' => add_query_arg('tab', 'billing', $dashboard_url)
    ];
    
    // My Complaints tab (Verified Reviewer and Attorney Pro)
    if (aah_can_file_complaints($user_id)) {
        $items['complaints'] = [
            'label' => __('My Complaints', 'attorney-hub'),
            'icon' => 'la la-exclamation-triangle',
            'url' => add_query_arg('tab', 'complaints', $dashboard_url)
        ];
    }
    
    // Complaints Against Me tab (Attorney Pro only)
    if (aah_is_attorney_pro($user_id)) {
        $items['complaints-received'] = [
            'label' => __('Complaints Against Me', 'attorney-hub'),
            'icon' => 'la la-shield-alt',
            'url' => add_query_arg('tab', 'complaints-received', $dashboard_url)
        ];
    }
    
    return $items;
}

/**
 * Display custom tab content
 */
add_action('atbdp_dashboard_tab_content', 'aah_display_tab_content');
function aah_display_tab_content() {
    $tab = isset($_GET['tab']) ? sanitize_text_field($_GET['tab']) : '';
    
    switch($tab) {
        case 'membership':
            aah_get_template('tab-membership.php');
            break;
            
        case 'billing':
            aah_get_template('tab-billing.php');
            break;
            
        case 'complaints':
            aah_get_template('tab-complaints.php');
            break;
            
        case 'complaints-received':
            aah_get_template('tab-complaints-received.php');
            break;
    }
}
```

### 5. Complaints System (includes/complaints.php)

```php
<?php
/**
 * Complaints System
 */

if (!defined('ABSPATH')) exit;

/**
 * Register custom post type for complaints
 */
add_action('init', 'aah_register_complaint_cpt');
function aah_register_complaint_cpt() {
    register_post_type('attorney_complaint', [
        'labels' => [
            'name' => __('Complaints', 'attorney-hub'),
            'singular_name' => __('Complaint', 'attorney-hub'),
            'add_new' => __('Add New Complaint', 'attorney-hub'),
            'add_new_item' => __('Add New Complaint', 'attorney-hub'),
            'edit_item' => __('Edit Complaint', 'attorney-hub'),
            'view_item' => __('View Complaint', 'attorney-hub'),
            'search_items' => __('Search Complaints', 'attorney-hub')
        ],
        'public' => false,
        'show_ui' => true,
        'show_in_menu' => true,
        'capability_type' => 'post',
        'capabilities' => [
            'create_posts' => false // Prevent manual creation via admin
        ],
        'map_meta_cap' => true,
        'supports' => ['title', 'editor', 'author'],
        'menu_icon' => 'dashicons-warning',
        'menu_position' => 26
    ]);
    
    // Register custom post statuses
    register_post_status('under_review', [
        'label' => __('Under Review', 'attorney-hub'),
        'public' => false,
        'show_in_admin_all_list' => true,
        'show_in_admin_status_list' => true,
        'label_count' => _n_noop('Under Review <span class="count">(%s)</span>', 'Under Review <span class="count">(%s)</span>', 'attorney-hub')
    ]);
    
    register_post_status('resolved', [
        'label' => __('Resolved', 'attorney-hub'),
        'public' => false,
        'show_in_admin_all_list' => true,
        'show_in_admin_status_list' => true,
        'label_count' => _n_noop('Resolved <span class="count">(%s)</span>', 'Resolved <span class="count">(%s)</span>', 'attorney-hub')
    ]);
    
    register_post_status('dismissed', [
        'label' => __('Dismissed', 'attorney-hub'),
        'public' => false,
        'show_in_admin_all_list' => true,
        'show_in_admin_status_list' => true,
        'label_count' => _n_noop('Dismissed <span class="count">(%s)</span>', 'Dismissed <span class="count">(%s)</span>', 'attorney-hub')
    ]);
}

/**
 * Add custom columns to complaints admin list
 */
add_filter('manage_attorney_complaint_posts_columns', 'aah_complaint_columns');
function aah_complaint_columns($columns) {
    $new_columns = [
        'cb' => $columns['cb'],
        'title' => __('Complaint', 'attorney-hub'),
        'attorney' => __('Attorney', 'attorney-hub'),
        'complainant' => __('Filed By', 'attorney-hub'),
        'date' => __('Date Filed', 'attorney-hub'),
        'status' => __('Status', 'attorney-hub')
    ];
    return $new_columns;
}

add_action('manage_attorney_complaint_posts_custom_column', 'aah_complaint_column_content', 10, 2);
function aah_complaint_column_content($column, $post_id) {
    switch($column) {
        case 'attorney':
            $attorney_id = get_post_meta($post_id, '_attorney_id', true);
            if ($attorney_id) {
                $attorney = get_post($attorney_id);
                echo '<a href="' . get_edit_post_link($attorney_id) . '">' . esc_html($attorney->post_title) . '</a>';
            }
            break;
            
        case 'complainant':
            $author_id = get_post_field('post_author', $post_id);
            $author = get_userdata($author_id);
            echo esc_html($author->display_name);
            break;
            
        case 'status':
            $status = get_post_status($post_id);
            $status_labels = [
                'pending' => __('Pending', 'attorney-hub'),
                'under_review' => __('Under Review', 'attorney-hub'),
                'resolved' => __('Resolved', 'attorney-hub'),
                'dismissed' => __('Dismissed', 'attorney-hub')
            ];
            echo isset($status_labels[$status]) ? $status_labels[$status] : ucfirst($status);
            break;
    }
}

/**
 * Handle complaint form submission
 */
add_action('admin_post_submit_complaint', 'aah_handle_complaint_submission');
add_action('admin_post_nopriv_submit_complaint', 'aah_handle_complaint_submission');
function aah_handle_complaint_submission() {
    // Verify nonce
    if (!isset($_POST['complaint_nonce']) || !wp_verify_nonce($_POST['complaint_nonce'], 'submit_complaint')) {
        wp_die(__('Security check failed', 'attorney-hub'), 403);
    }
    
    // Check user is logged in
    if (!is_user_logged_in()) {
        wp_redirect(wp_login_url(home_url('/file-a-complaint/')));
        exit;
    }
    
    // Check capability
    $user_id = get_current_user_id();
    if (!aah_can_file_complaints($user_id)) {
        wp_die(__('You do not have permission to file complaints. Please upgrade your membership.', 'attorney-hub'), 403);
    }
    
    // Sanitize input
    $attorney_id = intval($_POST['attorney_id']);
    $complaint_text = sanitize_textarea_field($_POST['complaint_text']);
    
    // Validate
    $errors = [];
    
    if (empty($attorney_id)) {
        $errors[] = __('Please select an attorney', 'attorney-hub');
    }
    
    if (empty($complaint_text) || strlen($complaint_text) < 50) {
        $errors[] = __('Complaint must be at least 50 characters', 'attorney-hub');
    }
    
    // Check if attorney exists
    $attorney = get_post($attorney_id);
    if (!$attorney || $attorney->post_type !== 'at_biz_dir') {
        $errors[] = __('Invalid attorney selected', 'attorney-hub');
    }
    
    // If there are errors, redirect back
    if (!empty($errors)) {
        $error_message = implode('<br>', $errors);
        wp_redirect(add_query_arg('error', urlencode($error_message), wp_get_referer()));
        exit;
    }
    
    // Create complaint
    $complaint_id = wp_insert_post([
        'post_type' => 'attorney_complaint',
        'post_title' => sprintf(__('Complaint against %s', 'attorney-hub'), $attorney->post_title),
        'post_content' => $complaint_text,
        'post_status' => 'pending',
        'post_author' => $user_id
    ]);
    
    if (is_wp_error($complaint_id)) {
        wp_redirect(add_query_arg('error', urlencode($complaint_id->get_error_message()), wp_get_referer()));
        exit;
    }
    
    // Save metadata
    update_post_meta($complaint_id, '_attorney_id', $attorney_id);
    update_post_meta($complaint_id, '_filed_date', current_time('mysql'));
    
    // Handle file upload
    if (!empty($_FILES['evidence']['name'])) {
        require_once(ABSPATH . 'wp-admin/includes/file.php');
        require_once(ABSPATH . 'wp-admin/includes/media.php');
        require_once(ABSPATH . 'wp-admin/includes/image.php');
        
        // Validate file type
        $allowed_types = ['application/pdf', 'image/jpeg', 'image/jpg', 'image/png'];
        $file_type = $_FILES['evidence']['type'];
        
        if (in_array($file_type, $allowed_types)) {
            $attachment_id = media_handle_upload('evidence', $complaint_id);
            
            if (!is_wp_error($attachment_id)) {
                update_post_meta($complaint_id, '_evidence_file', $attachment_id);
            }
        }
    }
    
    // Send email notification to admin
    $admin_email = get_option('admin_email');
    $subject = __('New Complaint Filed - Requires Review', 'attorney-hub');
    $message = sprintf(
        __('A new complaint has been filed and requires your review.

Complaint Details:
- Attorney: %s
- Filed by: %s
- Date: %s

View complaint: %s', 'attorney-hub'),
        $attorney->post_title,
        wp_get_current_user()->display_name,
        current_time('F j, Y g:i a'),
        admin_url('post.php?post=' . $complaint_id . '&action=edit')
    );
    
    wp_mail($admin_email, $subject, $message);
    
    // Redirect to dashboard with success message
    $redirect_url = add_query_arg([
        'tab' => 'complaints',
        'success' => '1'
    ], get_permalink(ATTORNEY_HUB_DASHBOARD_ID));
    
    wp_redirect($redirect_url);
    exit;
}

/**
 * Shortcode for complaint form
 */
add_shortcode('complaint_form', 'aah_complaint_form_shortcode');
function aah_complaint_form_shortcode($atts) {
    // Check if user is logged in
    if (!is_user_logged_in()) {
        $login_url = wp_login_url(get_permalink());
        return '<p>' . sprintf(__('Please <a href="%s">login</a> to file a complaint.', 'attorney-hub'), esc_url($login_url)) . '</p>';
    }
    
    // Check capability
    if (!aah_can_file_complaints(get_current_user_id())) {
        $pricing_url = home_url('/plans/pricing/');
        return '<div class="aah-upgrade-notice">
            <p>' . __('You need to be a <strong>Verified Reviewer</strong> or <strong>Attorney Pro</strong> member to file complaints.', 'attorney-hub') . '</p>
            <a href="' . esc_url($pricing_url) . '" class="button">' . __('Upgrade Membership', 'attorney-hub') . '</a>
        </div>';
    }
    
    ob_start();
    aah_get_template('complaint-form.php');
    return ob_get_clean();
}
```

### 6. Templates

**templates/tab-membership.php**
```php
<?php
if (!defined('ABSPATH')) exit;

if (!function_exists('mepr_get_current_user')) {
    echo '<p>' . __('MemberPress is not active.', 'attorney-hub') . '</p>';
    return;
}

$user = mepr_get_current_user();
$memberships = $user->active_product_subscriptions('ids');
?>
<div class="aah-membership-tab">
    <h2><?php _e('My Membership', 'attorney-hub'); ?></h2>
    
    <?php if (!empty($memberships)): ?>
        <div class="aah-memberships-list">
            <?php foreach ($memberships as $sub_id): 
                $sub = new MeprSubscription($sub_id);
                $product = $sub->product();
            ?>
            <div class="aah-membership-card active">
                <div class="aah-membership-header">
                    <h3><?php echo esc_html($product->post_title); ?></h3>
                    <span class="aah-status-badge status-<?php echo esc_attr(strtolower($sub->status)); ?>">
                        <?php echo esc_html(ucfirst($sub->status)); ?>
                    </span>
                </div>
                
                <div class="aah-membership-details">
                    <div class="aah-detail-row">
                        <span class="label"><?php _e('Member Since:', 'attorney-hub'); ?></span>
                        <span class="value"><?php echo date_i18n('F j, Y', strtotime($sub->created_at)); ?></span>
                    </div>
                    
                    <?php if ($sub->expires_at && $sub->expires_at != '0000-00-00 00:00:00'): ?>
                    <div class="aah-detail-row">
                        <span class="label"><?php _e('Expires:', 'attorney-hub'); ?></span>
                        <span class="value"><?php echo date_i18n('F j, Y', strtotime($sub->expires_at)); ?></span>
                    </div>
                    <?php else: ?>
                    <div class="aah-detail-row">
                        <span class="label"><?php _e('Subscription:', 'attorney-hub'); ?></span>
                        <span class="value"><?php _e('Lifetime', 'attorney-hub'); ?></span>
                    </div>
                    <?php endif; ?>
                    
                    <?php if ($product->price > 0): ?>
                    <div class="aah-detail-row">
                        <span class="label"><?php _e('Price:', 'attorney-hub'); ?></span>
                        <span class="value"><?php echo MeprAppHelper::format_currency($product->price); ?></span>
                    </div>
                    <?php endif; ?>
                </div>
                
                <?php
                // Show membership benefits
                $benefits = aah_get_membership_benefits($product->post_name);
                if (!empty($benefits)):
                ?>
                <div class="aah-membership-benefits">
                    <h4><?php _e('Your Benefits:', 'attorney-hub'); ?></h4>
                    <ul>
                        <?php foreach ($benefits as $benefit): ?>
                        <li><i class="la la-check-circle"></i> <?php echo esc_html($benefit); ?></li>
                        <?php endforeach; ?>
                    </ul>
                </div>
                <?php endif; ?>
            </div>
            <?php endforeach; ?>
        </div>
    <?php else: ?>
        <div class="aah-no-membership">
            <p><?php _e('You don\'t have an active membership.', 'attorney-hub'); ?></p>
            <a href="<?php echo esc_url(home_url('/plans/pricing/')); ?>" class="aah-btn aah-btn-primary">
                <?php _e('View Membership Plans', 'attorney-hub'); ?>
            </a>
        </div>
    <?php endif; ?>
    
    <div class="aah-membership-actions">
        <a href="<?php echo esc_url(home_url('/plans/pricing/')); ?>" class="aah-btn aah-btn-secondary">
            <?php _e('Upgrade / Change Plan', 'attorney-hub'); ?>
        </a>
    </div>
</div>

<?php
/**
 * Get membership benefits by slug
 */
function aah_get_membership_benefits($membership_slug) {
    $benefits = [
        'free-member' => [
            __('Browse attorney directory', 'attorney-hub'),
            __('View attorney profiles', 'attorney-hub'),
            __('Search by location and practice area', 'attorney-hub')
        ],
        'verified-reviewer' => [
            __('Submit reviews for attorneys', 'attorney-hub'),
            __('File complaints with evidence', 'attorney-hub'),
            __('Save favorite attorneys', 'attorney-hub'),
            __('All Free Member benefits', 'attorney-hub')
        ],
        'attorney-pro' => [
            __('Claim and edit your attorney profile', 'attorney-hub'),
            __('Respond to complaints (view only)', 'attorney-hub'),
            __('Upload professional documents', 'attorney-hub'),
            __('Enhanced profile visibility', 'attorney-hub'),
            __('All Verified Reviewer benefits', 'attorney-hub')
        ]
    ];
    
    return isset($benefits[$membership_slug]) ? $benefits[$membership_slug] : [];
}
```

**templates/tab-billing.php**
```php
<?php
if (!defined('ABSPATH')) exit;

if (!function_exists('mepr_get_current_user')) {
    echo '<p>' . __('MemberPress is not active.', 'attorney-hub') . '</p>';
    return;
}

$user = mepr_get_current_user();
$transactions = $user->transactions();
?>
<div class="aah-billing-tab">
    <h2><?php _e('Billing History', 'attorney-hub'); ?></h2>
    
    <?php if (!empty($transactions)): ?>
        <div class="aah-table-responsive">
            <table class="aah-billing-table">
                <thead>
                    <tr>
                        <th><?php _e('Date', 'attorney-hub'); ?></th>
                        <th><?php _e('Description', 'attorney-hub'); ?></th>
                        <th><?php _e('Amount', 'attorney-hub'); ?></th>
                        <th><?php _e('Status', 'attorney-hub'); ?></th>
                        <th><?php _e('Invoice', 'attorney-hub'); ?></th>
                    </tr>
                </thead>
                <tbody>
                    <?php foreach ($transactions as $txn): 
                        $product = $txn->product();
                    ?>
                    <tr>
                        <td data-label="<?php _e('Date', 'attorney-hub'); ?>">
                            <?php echo date_i18n('M j, Y', strtotime($txn->created_at)); ?>
                        </td>
                        <td data-label="<?php _e('Description', 'attorney-hub'); ?>">
                            <strong><?php echo esc_html($product->post_title); ?></strong>
                            <?php if ($txn->subscription_id): ?>
                                <br><small><?php _e('Subscription Payment', 'attorney-hub'); ?></small>
                            <?php endif; ?>
                        </td>
                        <td data-label="<?php _e('Amount', 'attorney-hub'); ?>">
                            <strong><?php echo MeprAppHelper::format_currency($txn->total); ?></strong>
                        </td>
                        <td data-label="<?php _e('Status', 'attorney-hub'); ?>">
                            <span class="aah-status-badge status-<?php echo esc_attr(strtolower($txn->status)); ?>">
                                <?php echo esc_html(ucfirst($txn->status)); ?>
                            </span>
                        </td>
                        <td data-label="<?php _e('Invoice', 'attorney-hub'); ?>">
                            <?php if ($txn->status == MeprTransaction::$complete_str): ?>
                                <a href="<?php echo esc_url($txn->invoice_url()); ?>" target="_blank" class="aah-invoice-link">
                                    <i class="la la-file-pdf"></i> <?php _e('View', 'attorney-hub'); ?>
                                </a>
                            <?php else: ?>
                                <span class="aah-text-muted">—</span>
                            <?php endif; ?>
                        </td>
                    </tr>
                    <?php endforeach; ?>
                </tbody>
            </table>
        </div>
    <?php else: ?>
        <div class="aah-empty-state">
            <i class="la la-file-invoice"></i>
            <p><?php _e('No billing history yet.', 'attorney-hub'); ?></p>
        </div>
    <?php endif; ?>
</div>
```

**templates/tab-complaints.php**
```php
<?php
if (!defined('ABSPATH')) exit;

$user_id = get_current_user_id();
$complaints = get_posts([
    'post_type' => 'attorney_complaint',
    'author' => $user_id,
    'posts_per_page' => -1,
    'post_status' => 'any'
]);

$success = isset($_GET['success']) && $_GET['success'] == '1';
$error = isset($_GET['error']) ? urldecode($_GET['error']) : '';
?>
<div class="aah-complaints-tab">
    <h2><?php _e('My Complaints', 'attorney-hub'); ?></h2>
    
    <?php if ($success): ?>
        <div class="aah-notice aah-notice-success">
            <?php _e('Your complaint has been submitted successfully and is pending admin review.', 'attorney-hub'); ?>
        </div>
    <?php endif; ?>
    
    <?php if ($error): ?>
        <div class="aah-notice aah-notice-error">
            <?php echo esc_html($error); ?>
        </div>
    <?php endif; ?>
    
    <?php if (!empty($complaints)): ?>
        <div class="aah-complaints-list">
            <?php foreach ($complaints as $complaint): 
                $attorney_id = get_post_meta($complaint->ID, '_attorney_id', true);
                $status = get_post_status($complaint);
                $evidence_file = get_post_meta($complaint->ID, '_evidence_file', true);
            ?>
            <div class="aah-complaint-item">
                <div class="aah-complaint-header">
                    <div>
                        <h3><?php _e('Complaint against:', 'attorney-hub'); ?> 
                            <a href="<?php echo get_permalink($attorney_id); ?>">
                                <?php echo esc_html(get_the_title($attorney_id)); ?>
                            </a>
                        </h3>
                        <div class="aah-complaint-meta">
                            <span><i class="la la-calendar"></i> <?php echo get_the_date('', $complaint); ?></span>
                        </div>
                    </div>
                    <span class="aah-status-badge status-<?php echo esc_attr($status); ?>">
                        <?php 
                        $status_labels = [
                            'pending' => __('Pending Review', 'attorney-hub'),
                            'under_review' => __('Under Review', 'attorney-hub'),
                            'resolved' => __('Resolved', 'attorney-hub'),
                            'dismissed' => __('Dismissed', 'attorney-hub')
                        ];
                        echo isset($status_labels[$status]) ? $status_labels[$status] : ucfirst($status);
                        ?>
                    </span>
                </div>
                
                <div class="aah-complaint-content">
                    <?php echo wp_trim_words($complaint->post_content, 40); ?>
                </div>
                
                <?php if ($evidence_file): ?>
                    <div class="aah-complaint-evidence">
                        <i class="la la-paperclip"></i>
                        <a href="<?php echo wp_get_attachment_url($evidence_file); ?>" target="_blank">
                            <?php _e('View Evidence', 'attorney-hub'); ?>
                        </a>
                    </div>
                <?php endif; ?>
            </div>
            <?php endforeach; ?>
        </div>
    <?php else: ?>
        <div class="aah-empty-state">
            <i class="la la-exclamation-triangle"></i>
            <h3><?php _e('No Complaints Filed', 'attorney-hub'); ?></h3>
            <p><?php _e('You haven\'t filed any complaints yet.', 'attorney-hub'); ?></p>
            <a href="<?php echo esc_url(home_url('/file-a-complaint/')); ?>" class="aah-btn aah-btn-primary">
                <i class="la la-plus"></i> <?php _e('File a Complaint', 'attorney-hub'); ?>
            </a>
        </div>
    <?php endif; ?>
</div>
```

**templates/tab-complaints-received.php**
```php
<?php
if (!defined('ABSPATH')) exit;

$user_id = get_current_user_id();

// Get attorney's claimed listings
$claimed_listings = get_posts([
    'post_type' => 'at_biz_dir',
    'author' => $user_id,
    'posts_per_page' => -1,
    'fields' => 'ids'
]);

if (empty($claimed_listings)) {
    ?>
    <div class="aah-empty-state">
        <i class="la la-shield-alt"></i>
        <h3><?php _e('No Claimed Listings', 'attorney-hub'); ?></h3>
        <p><?php _e('You need to claim an attorney profile first to see complaints against you.', 'attorney-hub'); ?></p>
        <a href="<?php echo esc_url(home_url('/all-attorneys/')); ?>" class="aah-btn aah-btn-primary">
            <?php _e('Browse Attorneys', 'attorney-hub'); ?>
        </a>
    </div>
    <?php
    return;
}

// Get complaints against these listings
$complaints = get_posts([
    'post_type' => 'attorney_complaint',
    'posts_per_page' => -1,
    'post_status' => 'any',
    'meta_query' => [
        [
            'key' => '_attorney_id',
            'value' => $claimed_listings,
            'compare' => 'IN'
        ]
    ]
]);
?>
<div class="aah-attorney-complaints-tab">
    <h2><?php _e('Complaints Against Me', 'attorney-hub'); ?></h2>
    
    <?php if (!empty($complaints)): ?>
        <?php
        // Count by status
        $pending = 0;
        $under_review = 0;
        $resolved = 0;
        foreach ($complaints as $c) {
            $status = get_post_status($c);
            if ($status == 'pending') $pending++;
            if ($status == 'under_review') $under_review++;
            if ($status == 'resolved') $resolved++;
        }
        ?>
        
        <div class="aah-stats-cards">
            <div class="aah-stat-card">
                <div class="aah-stat-number"><?php echo count($complaints); ?></div>
                <div class="aah-stat-label"><?php _e('Total Complaints', 'attorney-hub'); ?></div>
            </div>
            <div class="aah-stat-card">
                <div class="aah-stat-number"><?php echo $pending + $under_review; ?></div>
                <div class="aah-stat-label"><?php _e('Pending', 'attorney-hub'); ?></div>
            </div>
            <div class="aah-stat-card">
                <div class="aah-stat-number"><?php echo $resolved; ?></div>
                <div class="aah-stat-label"><?php _e('Resolved', 'attorney-hub'); ?></div>
            </div>
        </div>
        
        <div class="aah-complaints-list">
            <?php foreach ($complaints as $complaint): 
                $complainant_id = $complaint->post_author;
                $complainant = get_userdata($complainant_id);
                $status = get_post_status($complaint);
                $evidence_file = get_post_meta($complaint->ID, '_evidence_file', true);
            ?>
            <div class="aah-complaint-item">
                <div class="aah-complaint-header">
                    <div>
                        <h4><?php _e('Complaint from:', 'attorney-hub'); ?> 
                            <?php echo esc_html($complainant ? $complainant->display_name : 'Anonymous'); ?>
                        </h4>
                        <div class="aah-complaint-meta">
                            <span><i class="la la-calendar"></i> <?php echo get_the_date('', $complaint); ?></span>
                        </div>
                    </div>
                    <span class="aah-status-badge status-<?php echo esc_attr($status); ?>">
                        <?php 
                        $status_labels = [
                            'pending' => __('Pending Review', 'attorney-hub'),
                            'under_review' => __('Under Review', 'attorney-hub'),
                            'resolved' => __('Resolved', 'attorney-hub'),
                            'dismissed' => __('Dismissed', 'attorney-hub')
                        ];
                        echo isset($status_labels[$status]) ? $status_labels[$status] : ucfirst($status);
                        ?>
                    </span>
                </div>
                
                <div class="aah-complaint-content">
                    <?php echo wpautop($complaint->post_content); ?>
                </div>
                
                <?php if ($evidence_file): ?>
                    <div class="aah-complaint-evidence">
                        <strong><?php _e('Evidence:', 'attorney-hub'); ?></strong>
                        <a href="<?php echo wp_get_attachment_url($evidence_file); ?>" target="_blank">
                            <i class="la la-paperclip"></i> <?php _e('View Attached File', 'attorney-hub'); ?>
                        </a>
                    </div>
                <?php endif; ?>
            </div>
            <?php endforeach; ?>
        </div>
        
    <?php else: ?>
        <div class="aah-empty-state success">
            <i class="la la-check-circle"></i>
            <h3><?php _e('No Complaints', 'attorney-hub'); ?></h3>
            <p><?php _e('Great news! You don\'t have any complaints filed against you.', 'attorney-hub'); ?></p>
        </div>
    <?php endif; ?>
</div>
```

**templates/complaint-form.php**
```php
<?php
if (!defined('ABSPATH')) exit;

$attorneys = aah_get_attorneys_list();
$error = isset($_GET['error']) ? urldecode($_GET['error']) : '';
?>
<div class="aah-complaint-form-wrapper">
    <h2><?php _e('File a Complaint', 'attorney-hub'); ?></h2>
    <p><?php _e('Please provide detailed information about your complaint. All submissions are reviewed by our team before being published.', 'attorney-hub'); ?></p>
    
    <?php if ($error): ?>
        <div class="aah-notice aah-notice-error">
            <?php echo esc_html($error); ?>
        </div>
    <?php endif; ?>
    
    <form method="post" action="<?php echo esc_url(admin_url('admin-post.php')); ?>" enctype="multipart/form-data" class="aah-complaint-form">
        <input type="hidden" name="action" value="submit_complaint">
        <?php wp_nonce_field('submit_complaint', 'complaint_nonce'); ?>
        
        <div class="aah-form-group">
            <label for="attorney_id"><?php _e('Select Attorney', 'attorney-hub'); ?> <span class="required">*</span></label>
            <select name="attorney_id" id="attorney_id" required class="aah-form-control">
                <option value=""><?php _e('-- Select Attorney --', 'attorney-hub'); ?></option>
                <?php foreach ($attorneys as $attorney): ?>
                    <option value="<?php echo esc_attr($attorney->ID); ?>">
                        <?php echo esc_html($attorney->post_title); ?>
                    </option>
                <?php endforeach; ?>
            </select>
        </div>
        
        <div class="aah-form-group">
            <label for="complaint_text"><?php _e('Describe Your Complaint', 'attorney-hub'); ?> <span class="required">*</span></label>
            <textarea 
                name="complaint_text" 
                id="complaint_text" 
                rows="8" 
                required 
                minlength="50"
                class="aah-form-control"
                placeholder="<?php _e('Please provide detailed information about your complaint...', 'attorney-hub'); ?>"
            ></textarea>
            <small class="aah-form-help"><?php _e('Minimum 50 characters required', 'attorney-hub'); ?></small>
        </div>
        
        <div class="aah-form-group">
            <label for="evidence"><?php _e('Upload Evidence (Optional)', 'attorney-hub'); ?></label>
            <input 
                type="file" 
                name="evidence" 
                id="evidence" 
                accept=".pdf,.jpg,.jpeg,.png"
                class="aah-form-control"
            >
            <small class="aah-form-help"><?php _e('Accepted formats: PDF, JPG, PNG (Max 5MB)', 'attorney-hub'); ?></small>
        </div>
        
        <div class="aah-form-actions">
            <button type="submit" class="aah-btn aah-btn-primary aah-btn-lg">
                <i class="la la-paper-plane"></i> <?php _e('Submit Complaint', 'attorney-hub'); ?>
            </button>
            <a href="<?php echo esc_url(get_permalink(ATTORNEY_HUB_DASHBOARD_ID)); ?>" class="aah-btn aah-btn-secondary">
                <?php _e('Cancel', 'attorney-hub'); ?>
            </a>
        </div>
    </form>
</div>
```

### 7. Styles (assets/css/dashboard.css)

```css
/**
 * Attorney Hub - Dashboard Styles
 */

/* General Dashboard Styles */
.aah-membership-tab,
.aah-billing-tab,
.aah-complaints-tab,
.aah-attorney-complaints-tab {
    padding: 20px;
}

/* Membership Cards */
.aah-memberships-list {
    margin-bottom: 20px;
}

.aah-membership-card {
    background: #fff;
    border: 2px solid #e8e8e8;
    border-radius: 10px;
    padding: 25px;
    margin-bottom: 20px;
}

.aah-membership-card.active {
    border-color: #4CAF50;
    box-shadow: 0 2px 8px rgba(76, 175, 80, 0.1);
}

.aah-membership-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin-bottom: 20px;
    padding-bottom: 15px;
    border-bottom: 2px solid #f0f0f0;
}

.aah-membership-header h3 {
    margin: 0;
    font-size: 20px;
    color: #222;
}

.aah-status-badge {
    display: inline-block;
    padding: 5px 12px;
    border-radius: 20px;
    font-size: 11px;
    font-weight: 600;
    text-transform: uppercase;
}

.aah-status-badge.status-active,
.aah-status-badge.status-complete {
    background: #E8F5E9;
    color: #2E7D32;
}

.aah-status-badge.status-pending,
.aah-status-badge.status-under_review {
    background: #FFF3E0;
    color: #E65100;
}

.aah-status-badge.status-resolved {
    background: #E3F2FD;
    color: #1565C0;
}

.aah-status-badge.status-dismissed,
.aah-status-badge.status-cancelled {
    background: #FFEBEE;
    color: #C62828;
}

.aah-membership-details {
    margin-bottom: 20px;
}

.aah-detail-row {
    display: flex;
    justify-content: space-between;
    padding: 10px 0;
    border-bottom: 1px solid #f5f5f5;
}

.aah-detail-row .label {
    color: #666;
    font-size: 14px;
}

.aah-detail-row .value {
    color: #222;
    font-weight: 600;
    font-size: 14px;
}

.aah-membership-benefits {
    margin-top: 20px;
    padding-top: 20px;
    border-top: 2px solid #f0f0f0;
}

.aah-membership-benefits h4 {
    margin: 0 0 12px 0;
    font-size: 15px;
    color: #444;
}

.aah-membership-benefits ul {
    list-style: none;
    padding: 0;
    margin: 0;
}

.aah-membership-benefits li {
    padding: 6px 0;
    color: #555;
    font-size: 14px;
}

.aah-membership-benefits li i {
    color: #4CAF50;
    margin-right: 8px;
}

/* Billing Table */
.aah-table-responsive {
    overflow-x: auto;
    margin-bottom: 20px;
}

.aah-billing-table {
    width: 100%;
    border-collapse: collapse;
    background: #fff;
    border: 1px solid #e8e8e8;
    border-radius: 8px;
}

.aah-billing-table th {
    background: #f8f9fa;
    padding: 12px 15px;
    text-align: left;
    font-weight: 600;
    font-size: 13px;
    color: #444;
    text-transform: uppercase;
    border-bottom: 2px solid #e8e8e8;
}

.aah-billing-table td {
    padding: 15px;
    border-bottom: 1px solid #f0f0f0;
    font-size: 14px;
}

.aah-billing-table tbody tr:hover {
    background: #f8f9fa;
}

.aah-invoice-link {
    color: #1976D2;
    text-decoration: none;
    font-weight: 500;
}

.aah-invoice-link:hover {
    text-decoration: underline;
}

/* Complaints */
.aah-complaints-list {
    margin-bottom: 20px;
}

.aah-complaint-item {
    background: #fff;
    border: 1px solid #e0e0e0;
    border-radius: 8px;
    padding: 20px;
    margin-bottom: 15px;
}

.aah-complaint-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin-bottom: 12px;
}

.aah-complaint-header h3,
.aah-complaint-header h4 {
    margin: 0 0 8px 0;
    font-size: 17px;
    color: #222;
}

.aah-complaint-meta {
    color: #666;
    font-size: 13px;
    margin-top: 5px;
}

.aah-complaint-meta i {
    margin-right: 5px;
}

.aah-complaint-content {
    color: #555;
    line-height: 1.6;
    margin-bottom: 12px;
}

.aah-complaint-evidence {
    padding: 10px;
    background: #f8f9fa;
    border-radius: 4px;
    font-size: 14px;
}

.aah-complaint-evidence i {
    margin-right: 5px;
}

/* Stats Cards */
.aah-stats-cards {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 15px;
    margin-bottom: 25px;
}

.aah-stat-card {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: #fff;
    padding: 20px;
    border-radius: 10px;
    text-align: center;
}

.aah-stat-number {
    font-size: 36px;
    font-weight: 700;
    margin-bottom: 5px;
}

.aah-stat-label {
    font-size: 13px;
    opacity: 0.9;
    text-transform: uppercase;
}

/* Empty States */
.aah-empty-state {
    text-align: center;
    padding: 50px 20px;
    background: #f8f9fa;
    border-radius: 10px;
}

.aah-empty-state.success {
    background: linear-gradient(135deg, #E8F5E9 0%, #C8E6C9 100%);
}

.aah-empty-state i {
    font-size: 60px;
    color: #999;
    margin-bottom: 15px;
}

.aah-empty-state.success i {
    color: #4CAF50;
}

.aah-empty-state h3 {
    margin: 0 0 10px 0;
    font-size: 22px;
    color: #333;
}

.aah-empty-state p {
    margin: 0 0 20px 0;
    color: #666;
    font-size: 15px;
}

/* Buttons */
.aah-btn {
    display: inline-block;
    padding: 10px 20px;
    border-radius: 6px;
    font-size: 14px;
    font-weight: 600;
    text-decoration: none;
    text-align: center;
    cursor: pointer;
    border: none;
    transition: all 0.3s;
}

.aah-btn i {
    margin-right: 5px;
}

.aah-btn-primary {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: #fff;
}

.aah-btn-primary:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
}

.aah-btn-secondary {
    background: #fff;
    color: #667eea;
    border: 2px solid #667eea;
}

.aah-btn-secondary:hover {
    background: #667eea;
    color: #fff;
}

.aah-btn-lg {
    padding: 12px 30px;
    font-size: 16px;
}

/* Complaint Form */
.aah-complaint-form-wrapper {
    max-width: 700px;
    margin: 0 auto;
    padding: 20px;
}

.aah-complaint-form-wrapper h2 {
    margin-bottom: 10px;
}

.aah-complaint-form-wrapper > p {
    color: #666;
    margin-bottom: 25px;
}

.aah-form-group {
    margin-bottom: 20px;
}

.aah-form-group label {
    display: block;
    margin-bottom: 8px;
    font-weight: 600;
    color: #333;
}

.aah-form-group .required {
    color: #d32f2f;
}

.aah-form-control {
    width: 100%;
    padding: 12px 15px;
    border: 1px solid #ddd;
    border-radius: 6px;
    font-size: 14px;
    transition: border-color 0.3s;
}

.aah-form-control:focus {
    outline: none;
    border-color: #667eea;
    box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
}

.aah-form-help {
    display: block;
    margin-top: 5px;
    font-size: 13px;
    color: #666;
}

.aah-form-actions {
    display: flex;
    gap: 10px;
    margin-top: 25px;
}

/* Notices */
.aah-notice {
    padding: 15px 20px;
    border-radius: 6px;
    margin-bottom: 20px;
}

.aah-notice-success {
    background: #E8F5E9;
    color: #2E7D32;
    border-left: 4px solid #4CAF50;
}

.aah-notice-error {
    background: #FFEBEE;
    color: #C62828;
    border-left: 4px solid #f44336;
}

.aah-upgrade-notice {
    background: #FFF3E0;
    border: 2px solid #FFB74D;
    border-radius: 8px;
    padding: 20px;
    text-align: center;
}

/* Membership Actions */
.aah-membership-actions,
.aah-no-membership {
    margin-top: 20px;
    text-align: center;
}

.aah-membership-actions {
    display: flex;
    gap: 10px;
    justify-content: center;
}

/* Responsive */
@media (max-width: 768px) {
    .aah-membership-header,
    .aah-complaint-header {
        flex-direction: column;
    }
    
    .aah-status-badge {
        margin-top: 10px;
    }
    
    .aah-billing-table thead {
        display: none;
    }
    
    .aah-billing-table tr {
        display: block;
        margin-bottom: 15px;
        border: 1px solid #e0e0e0;
        border-radius: 6px;
    }
    
    .aah-billing-table td {
        display: flex;
        justify-content: space-between;
        padding: 10px 15px;
    }
    
    .aah-billing-table td:before {
        content: attr(data-label);
        font-weight: 600;
        color: #444;
    }
    
    .aah-membership-actions,
    .aah-form-actions {
        flex-direction: column;
    }
    
    .aah-btn {
        width: 100%;
    }
}
```

### 8. JavaScript (assets/js/dashboard.js)

```javascript
/**
 * Attorney Hub - Dashboard Scripts
 */

(function($) {
    'use strict';
    
    $(document).ready(function() {
        initDashboard();
    });
    
    function initDashboard() {
        // Auto-dismiss success notices after 5 seconds
        setTimeout(function() {
            $('.aah-notice-success').fadeOut();
        }, 5000);
        
        // Confirm before submitting complaint
        $('.aah-complaint-form').on('submit', function(e) {
            var confirmed = confirm('Are you sure you want to submit this complaint? Please ensure all information is accurate.');
            if (!confirmed) {
                e.preventDefault();
                return false;
            }
        });
        
        // Character counter for complaint text
        var $textarea = $('#complaint_text');
        if ($textarea.length) {
            $textarea.after('<div class="aah-char-counter"><span class="current">0</span> / <span class="min">50</span> characters</div>');
            
            $textarea.on('input', function() {
                var length = $(this).val().length;
                $('.aah-char-counter .current').text(length);
                
                if (length >= 50) {
                    $('.aah-char-counter').css('color', '#4CAF50');
                } else {
                    $('.aah-char-counter').css('color', '#666');
                }
            });
        }
        
        // File upload validation
        $('#evidence').on('change', function() {
            var file = this.files[0];
            if (file) {
                var fileSize = file.size / 1024 / 1024; // in MB
                var allowedTypes = ['application/pdf', 'image/jpeg', 'image/png'];
                
                if (fileSize > 5) {
                    alert('File size must not exceed 5MB');
                    $(this).val('');
                    return false;
                }
                
                if (!allowedTypes.includes(file.type)) {
                    alert('Please upload only PDF, JPG, or PNG files');
                    $(this).val('');
                    return false;
                }
            }
        });
    }
    
})(jQuery);
```

---

## Installation Instructions

### Step 1: Create Plugin Folder
```
wp-content/plugins/attorney-hub/
```

### Step 2: Create All Files
Copy the code above into the respective files:
- `attorney-hub.php`
- `includes/helpers.php`
- `includes/capabilities.php`
- `includes/dashboard-tabs.php`
- `includes/complaints.php`
- `templates/tab-membership.php`
- `templates/tab-billing.php`
- `templates/tab-complaints.php`
- `templates/tab-complaints-received.php`
- `templates/complaint-form.php`
- `assets/css/dashboard.css`
- `assets/js/dashboard.js`

### Step 3: Activate Plugin
1. Go to WordPress Admin → Plugins
2. Find "Attorney Hub - Dashboard Unification"
3. Click Activate

### Step 4: Add Shortcode
Add `[complaint_form]` shortcode to your "File a Complaint" page

### Step 5: Test
1. Login with each user type (Free, Verified Reviewer, Attorney Pro)
2. Check dashboard tabs appear correctly
3. Test filing a complaint
4. Check admin receives email
5. Verify attorney can see complaint in dashboard

---

## Testing Checklist

- [ ] MemberPress account redirects to Directorist dashboard
- [ ] Free Member sees: Membership + Billing tabs only
- [ ] Verified Reviewer sees: + My Complaints tab
- [ ] Attorney Pro sees: All tabs including Complaints Against Me
- [ ] Membership tab shows active subscriptions
- [ ] Billing tab shows transaction history
- [ ] Complaint form works (file upload, validation)
- [ ] Admin receives email notification
- [ ] Complaint appears in user's "My Complaints" tab
- [ ] Attorney sees complaint in "Complaints Against Me" tab
- [ ] Only allowed users can file complaints/reviews
- [ ] Only Attorney Pro can claim listings
- [ ] Mobile responsive works
- [ ] No JavaScript errors in console
- [ ] No PHP errors in debug log

---

## Important Notes

### ✅ What's Already Done (Don't Create Again):
- Custom fields in Directorist
- Membership tiers in MemberPress
- All pages (dashboard, pricing, complaint)
- Search filters in Directorist
- OneListing theme setup

### 🎯 What to Build:
- Plugin files (12 files total)
- Dashboard unification
- Complaints system
- Integration with existing systems

### 🚫 Don't Do:
- Don't create new custom fields
- Don't hardcode URLs
- Don't create abstract classes
- Don't over-engineer
- Just make it work!

---

*Simple. Functional. Ready to Deploy.*